#ifndef settingsPhysics_h
#define settingsPhysics_h


#include "utilMath.h"


// Collider settings.
#define COLLIDER_HULL_USE_VERTEX_WEIGHT


// Physics settings.
/** Note: These update rates are unused! We just use the program's ones currently. **/
#define PHYSICS_BASE_UPDATE_RATE 125.f
#define PHYSICS_UPDATE_RATE 125.f
#define PHYSICS_VELOCITY_SOLVER_NUM_ITERATIONS 4
#define PHYSICS_POSITION_SOLVER_NUM_ITERATIONS 4

#define CONTACT_MANIFOLD_SIMPLE_KEYS

#define PHYSCONTACT_LINEAR_SLOP 0.005f
#define PHYSCONTACT_MAX_LINEAR_CORRECTION 0.2f
#define PHYSCONTACT_LINEAR_POSITIONAL_ERROR_THRESHOLD (-3.f * PHYSCONTACT_LINEAR_SLOP)

#define PHYSCONTACT_RESTITUTION_THRESHOLD 1.f

#define PHYSCONTACT_WARM_START
//#define PHYSCONTACT_STABILISER_BAUMGARTE
#define PHYSCONTACT_STABILISER_GAUSS_SEIDEL
#define PHYSCONTACT_BAUMGARTE_BIAS 0.2f

//#define PHYSCONTACT_USE_FRICTION_JOINT
//#define PHYSCONTACT_FRICTION_DELAY
#define PHYSCONTACT_FRICTION_GEOMETRIC_AVERAGE

#define PHYSJOINT_LINEAR_SLOP 0.005f
#define PHYSJOINT_LINEAR_SLOP_SQUARED (PHYSJOINT_LINEAR_SLOP*PHYSJOINT_LINEAR_SLOP)
#define PHYSJOINT_MAX_LINEAR_CORRECTION 0.2f
#define PHYSJOINT_LINEAR_POSITIONAL_ERROR_THRESHOLD (3.f * PHYSJOINT_LINEAR_SLOP)
#define PHYSJOINT_ANGULAR_SLOP DEG_TO_RAD(2.f)
#define PHYSJOINT_ANGULAR_SLOP_SQUARED (PHYSJOINT_ANGULAR_SLOP*PHYSJOINT_ANGULAR_SLOP)
#define PHYSJOINT_MAX_ANGULAR_CORRECTION DEG_TO_RAD(8.f)
#define PHYSJOINT_ANGULAR_POSITIONAL_ERROR_THRESHOLD (3.f * PHYSJOINT_ANGULAR_SLOP)

#define PHYSJOINTFRICTION_WARM_START
#define PHYSJOINTDISTANCE_WARM_START
#define PHYSJOINTFIXED_WARM_START
#define PHYSJOINTREVOLUTE_WARM_START
#define PHYSJOINTPRISMATIC_WARM_START
// Warm starting the spherical joint introduces too much "bounce-back".
// This seems to be an issue with both the angular and linear parts.
// Maybe have a look at this after fixing the Gauss-Seidel stabilizer.
#define PHYSJOINTSPHERE_WARM_START

#define PHYSJOINTDISTANCE_STABILISER_BAUMGARTE
#define PHYSJOINTDISTANCE_STABILISER_GAUSS_SEIDEL
#define PHYSJOINTFIXED_STABILISER_BAUMGARTE
#define PHYSJOINTFIXED_STABILISER_GAUSS_SEIDEL
#define PHYSJOINTREVOLUTE_STABILISER_BAUMGARTE
#define PHYSJOINTREVOLUTE_STABILISER_GAUSS_SEIDEL
#define PHYSJOINTPRISMATIC_STABILISER_BAUMGARTE
#define PHYSJOINTPRISMATIC_STABILISER_GAUSS_SEIDEL
//#define PHYSJOINTSPHERE_STABILISER_BAUMGARTE
#define PHYSJOINTSPHERE_STABILISER_GAUSS_SEIDEL
//#define PHYSJOINTSPHERE_DISABLE_ANGULAR_CONSTRAINT

// These coefficients are also used for Gauss-Seidel to prevent
// us from correcting the entire error in a single iteration.
#define PHYSJOINTDISTANCE_BAUMGARTE_BIAS  0.3f
#define PHYSJOINTFIXED_BAUMGARTE_BIAS     0.3f
#define PHYSJOINTREVOLUTE_BAUMGARTE_BIAS  0.3f
#define PHYSJOINTPRISMATIC_BAUMGARTE_BIAS 0.3f
#define PHYSJOINTSPHERE_BAUMGARTE_BIAS    0.3f

#define PHYSJOINTFIXED_ACCURATE_ANGULAR_MASS
//#define PHYSJOINTSPHERE_SWING_USE_ELLIPSE_NORMAL
//#define PHYSJOINTSPHERE_DEBUG

#define PHYSISLAND_AABBTREE_NODE_EXPAND_BY_VELOCITY
#define PHYSISLAND_AABBTREE_NODE_PADDING 0.2f

#define PHYSCOLLIDER_DEFAULT_MASS        0.f
#define PHYSCOLLIDER_DEFAULT_DENSITY     0.f
#define PHYSCOLLIDER_DEFAULT_FRICTION    1.f
#define PHYSCOLLIDER_DEFAULT_RESTITUTION 1.f
#define PHYSCOLLIDER_EXPLICIT_MASS

#define PHYSRIGIDBODY_GRAVITY -9.80665f


#endif